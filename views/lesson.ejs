<p>
    <%= formatDateShort(new Date(lesson.date)) %>
    <% if(lesson.time) { %>
        в <%= formatTime(lesson.time) %>
    <% } %>
    <% let remark = ''
    const flags = []
    if (lesson.is_distant) {
        flags.push('дистанционный')
    }
    if (lesson.is_control) {
        flags.push('контрольный')
    }
    if (flags.length) {
        remark = '(' + flags.join(', ') + ')';
    }
    if (lesson.is_distant) {
    %>
        <%= remark %>
    <% } %>
</p>

<% if(lesson.topic) { %>
    <p><b>Тема: </b><%= lesson.topic %></p>
<% } %>

<% if(lesson.task) { %>
    <p><b>Задание: </b><%= lesson.task %></p>
<% } %>

<p class="text-center">
    <a href="<%=makeUrl(['groups', group.id, 'lessons', lesson.id, 'edit'])%>"
       class="btn btn-light border-dark">Редактировать урок</a>
</p>

<ul id="menuTabs" class="nav nav-tabs">
    <li class="nav-item" id="marks">
        <a class="nav-link active" href="#">Выставление отметок</a>
    </li>
    <li class="nav-item" id="summary">
        <a class="nav-link" href="#">Сводка</a>
    </li>
</ul>
<div class="tab-content tab-border">
    <div class="tab-pane active" id="content_marks">

        <% skillsets.forEach( function(item) { const is_absense_skill = item.skill_id === absence_skill_id; %>
        <div class="d-block d-md-inline-block my-4 mx-3 text-center">
            <a href="<%=makeUrl(['groups', group.id, 'lessons', lesson.id, 'skill', item.skill_id])%>"
               class="btn <%=is_absense_skill ? 'btn-light border-primary text-primary' : 'btn-primary'%>">
                <%= item.Skill.name %>
            </a>
        </div>
        <% }); %>

    </div>
    <div class="tab-pane" id="content_summary">
        <div class="table-responsive my-4 px-1">
            <table class="table table-striped table-bordered table-hover table-sm">
                <thead>
                <tr>
                    <th scope="col" class="align-middle">Ученики</th>
                    <% used_skills.forEach( function(item) { %>
                    <th scope="col" class="text-center skill-title">
                        <a href="<%=makeUrl(['groups', group.id, 'lessons', lesson.id, 'skill', item.skill_id])%>">
                            <%= item.Skill.name %>
                        </a>
                    </th>
                    <% }); %>
                </tr>
                </thead>
                <tbody>
                <% students.forEach( function(student) { %>
                    <tr>
                        <th scope="row" class="align-middle">
                            <%= student.surname %>
                            <%= student.name %>
                        </th>
                        <% used_skills.forEach( function(item) {
                            const skills = getMarksForSkill(item.skill_id, absence_skill_id);
                        %>
                        <td class="align-middle text-center">
                            <% skills.forEach( function(mark) { %>
                                <% if (isCurrentMark(marks, lesson.id, student.id, item.skill_id, mark)) {%>
                                <a href="<%=makeUrl(['groups', group.id, 'lessons', lesson.id, 'skill', item.skill_id], [lesson.id, student.id, item.skill_id])%>">
                                    <%=mark%>
                                </a>
                                <% } %>
                            <% }) %>
                        </td>
                        <% }); %>
                    </tr>
                <% }); %>
                </tbody>
            </table>
        </div>
    </div>
</div>
